<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Jam Pulang TownlandJKT (puasa version)</title>

<style>

body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#eef2f6;
  font-family:Arial, sans-serif;
}

/* ===== NORMAL CARD ===== */
.card{
  background:white;
  padding:50px;
  border-radius:18px;
  box-shadow:0 15px 40px rgba(0,0,0,0.12);
  text-align:center;
  width:460px;
}

/* ===== WIDGET MODE ===== */
.widget body{
  background:transparent;
}

.widget .card{
  width:260px;
  padding:20px;
  box-shadow:0 8px 20px rgba(0,0,0,0.18);
}

.widget .info,
.widget .label,
.widget select,
.widget .small-btn,
.widget button.main{
  display:none;
}

.widget h1{
  font-size:16px;
  margin-bottom:10px;
}

/* ===== UI ===== */

.info{
  background:#f5f8ff;
  border-radius:10px;
  padding:15px;
  font-size:14px;
  margin-bottom:20px;
  line-height:1.6;
}

.nowTime{
  font-size:20px;
  font-weight:bold;
}

.nowDate{
  font-size:13px;
  color:#777;
  margin-bottom:10px;
}

.row{
  display:flex;
  justify-content:center;
  gap:8px;
}

.small-select{
  width:90px;
  padding:10px;
  border-radius:8px;
  border:1px solid #ddd;
}

.small-btn{
  font-size:12px;
  padding:6px 10px;
  margin-bottom:15px;
  background:#e3e8ef;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

button.main{
  width:100%;
  padding:14px;
  margin-top:18px;
  border-radius:10px;
  border:none;
  font-size:18px;
  background:#2c7be5;
  color:white;
  cursor:pointer;
}

.result{
  margin-top:15px;
  font-size:22px;
  font-weight:bold;
}

.countdown{
  margin-top:8px;
  font-size:18px;
  color:#2c7be5;
  font-weight:bold;
}

.label{
  margin-top:12px;
}

</style>
</head>

<body>

<div class="card">

<h1>ðŸ•Œ Jam Pulang TownlandJKT</h1>

<div class="info">
Jam masuk expected: <b>07:30</b><br>
Break: 12:00â€“12:30
</div>

<div class="nowTime">
<span id="currentTime">--:--:--</span>
</div>
<div class="nowDate" id="currentDate"></div>

<button class="small-btn" onclick="applyNowTime()">
Gunakan Jam Sekarang
</button>

<div class="label">Jam Masuk</div>
<div class="row">
<select id="hour" class="small-select"></select>
<select id="minute" class="small-select"></select>
</div>

<div class="label">Ekstra Istirahat</div>
<div class="row">
<select id="extraBreak" class="small-select"></select>
</div>

<button class="main" onclick="calculate()">Hitung</button>

<div class="result" id="result"></div>
<div class="countdown" id="countdown"></div>

</div>

<script>

/* ===== DETECT WIDGET MODE ===== */
if(new URLSearchParams(window.location.search).get("widget")=="1"){
  document.documentElement.classList.add("widget");
}

let targetEndTime=null;
let countdownInterval=null;

function getWIB(){
  return new Date(
    new Date().toLocaleString("en-US",{timeZone:"Asia/Jakarta"})
  );
}

/* ===== CLOCK ===== */
function updateClock(){
  const now=getWIB();

  document.getElementById("currentTime").innerText=
    now.toLocaleTimeString("id-ID");

  document.getElementById("currentDate").innerText=
    now.toLocaleDateString("id-ID",
      {weekday:"long",day:"numeric",month:"long",year:"numeric"});
}
setInterval(updateClock,1000);
updateClock();

/* ===== DROPDOWN ===== */
const hour=document.getElementById("hour");
for(let i=1;i<=24;i++){
  let v=String(i).padStart(2,'0');
  hour.add(new Option(v,v));
}
hour.value="07";

const minute=document.getElementById("minute");
for(let i=0;i<60;i++){
  let v=String(i).padStart(2,'0');
  minute.add(new Option(v,v));
}
minute.value="30";

const extra=document.getElementById("extraBreak");
extra.add(new Option("0 menit",0));
for(let i=1;i<=60;i++){
  extra.add(new Option(i+" menit",i));
}

/* ===== APPLY NOW ===== */
function applyNowTime(){
  const now=getWIB();
  hour.value=String(now.getHours()).padStart(2,'0');
  minute.value=String(now.getMinutes()).padStart(2,'0');
}

/* ===== COUNTDOWN ===== */
function startCountdown(){

  clearInterval(countdownInterval);

  countdownInterval=setInterval(()=>{
    const now=getWIB();
    let diff=targetEndTime-now;

    if(diff<=0){
      document.getElementById("countdown").innerHTML=
        "ðŸŸ¢ Sudah boleh pulang!";
      return;
    }

    let s=Math.floor(diff/1000);
    let h=Math.floor(s/3600);
    let m=Math.floor((s%3600)/60);
    let sec=s%60;

    document.getElementById("countdown").innerHTML=
      `â³ ${h}j ${m}m ${sec}d`;
  },1000);
}

/* ===== CALCULATE ===== */
function calculate(){

  const start=getWIB();
  start.setHours(hour.value,minute.value,0);

  let end=new Date(start.getTime()+7.5*60*60*1000);

  let breakStart=new Date(start);
  breakStart.setHours(12,0,0);

  if(start<breakStart && end>breakStart)
    end=new Date(end.getTime()+30*60000);

  end=new Date(end.getTime()+extra.value*60000);

  targetEndTime=end;
  startCountdown();

  document.getElementById("result").innerHTML=
    "Jam pulang kantor "+
    end.toLocaleTimeString("id-ID",{hour:'2-digit',minute:'2-digit'});
}

</script>

</body>
</html>
