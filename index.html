<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Jam Pulang TownlandJKT (puasa version)</title>

<style>

body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#eef2f6;
  font-family:Arial, sans-serif;
}

.card{
  background:white;
  padding:50px;
  border-radius:18px;
  box-shadow:0 15px 40px rgba(0,0,0,0.12);
  text-align:center;
  width:460px;
}

.info{
  background:#f5f8ff;
  border-radius:10px;
  padding:15px;
  font-size:14px;
  margin-bottom:20px;
  line-height:1.6;
}

/* JAM SEKARANG */
.nowTime{
  font-size:20px;
  font-weight:bold;
  color:#333;
}

.nowDate{
  font-size:13px;
  color:#777;
  margin-bottom:10px;
}

.small-btn{
  font-size:12px;
  padding:6px 10px;
  margin-bottom:15px;
  background:#e3e8ef;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.row{
  display:flex;
  justify-content:center;
  gap:8px;
}

.small-select{
  width:90px;
  padding:10px;
  border-radius:8px;
  border:1px solid #ddd;
  font-size:16px;
}

button.main{
  width:100%;
  padding:14px;
  margin-top:18px;
  border-radius:10px;
  border:none;
  font-size:18px;
  background:#2c7be5;
  color:white;
  cursor:pointer;
  font-weight:bold;
}

.result{
  margin-top:25px;
  font-size:24px;
  font-weight:bold;
}

.countdown{
  margin-top:10px;
  font-size:20px;
  color:#2c7be5;
  font-weight:bold;
}

.label{
  margin-top:12px;
  font-size:16px;
}

</style>
</head>

<body>

<div class="card">

<h1>ðŸ•Œ Jam Pulang TownlandJKT (puasa version)</h1>

<div class="info">
<b>Ketentuan Ramadhan:</b><br>
Jam masuk expected: <b>07:30</b><br>
Istirahat: <b>12:00 â€“ 12:30 (30 menit)</b><br>
Total kerja efektif: <b>7 jam 30 menit</b>
</div>

<div class="nowTime">
Jam sekarang (WIB): <span id="currentTime">--:--:--</span>
</div>
<div class="nowDate" id="currentDate"></div>

<button class="small-btn" onclick="applyNowTime()">
Gunakan Jam Sekarang
</button>

<div class="label">Jam Masuk</div>
<div class="row">
<select id="hour" class="small-select"></select>
<select id="minute" class="small-select"></select>
</div>

<div class="label">Ekstra Istirahat (opsional)</div>
<div class="row">
<select id="extraBreak" class="small-select"></select>
</div>

<button class="main" onclick="calculate()">Hitung Jam Pulang</button>

<div class="result" id="result"></div>
<div class="countdown" id="countdown"></div>

<button id="calendarBtn" class="main" style="display:none;">
Tambah ke Google Calendar
</button>

</div>

<script>

let countdownInterval=null;
let targetEndTime=null;

function getWIB(){
  return new Date(
    new Date().toLocaleString("en-US",{timeZone:"Asia/Jakarta"})
  );
}

// ===== JAM + TANGGAL WIB =====
function updateClock(){

  const now=getWIB();

  let h=String(now.getHours()).padStart(2,'0');
  let m=String(now.getMinutes()).padStart(2,'0');
  let s=String(now.getSeconds()).padStart(2,'0');

  document.getElementById("currentTime").innerText=`${h}:${m}:${s}`;

  const hari = now.toLocaleDateString("id-ID",{weekday:"long"});
  const tanggal = now.toLocaleDateString("id-ID",{
    day:"numeric",
    month:"long",
    year:"numeric"
  });

  document.getElementById("currentDate").innerText =
    `${hari}, ${tanggal}`;
}

setInterval(updateClock,1000);
updateClock();


// ===== DROPDOWN =====
const hourSelect=document.getElementById("hour");
for(let h=1;h<=24;h++){
  let hh=String(h).padStart(2,'0');
  hourSelect.add(new Option(hh,hh));
}
hourSelect.value="07";

const minuteSelect=document.getElementById("minute");
for(let m=0;m<60;m++){
  let mm=String(m).padStart(2,'0');
  minuteSelect.add(new Option(mm,mm));
}
minuteSelect.value="30";

const extraBreakSelect=document.getElementById("extraBreak");
extraBreakSelect.add(new Option("0 menit",0));
for(let i=1;i<=60;i++){
  extraBreakSelect.add(new Option(i+" menit",i));
}


// ===== APPLY JAM SEKARANG =====
function applyNowTime(){
  const now=getWIB();
  hourSelect.value=String(now.getHours()).padStart(2,'0');
  minuteSelect.value=String(now.getMinutes()).padStart(2,'0');
}


// ===== COUNTDOWN =====
function startCountdown(){

  if(countdownInterval) clearInterval(countdownInterval);

  countdownInterval=setInterval(()=>{

    const now=getWIB();
    let diff=targetEndTime-now;

    if(diff<=0){
      document.getElementById("countdown").innerHTML=
        "ðŸŸ¢ Sudah boleh pulang!";
      clearInterval(countdownInterval);
      return;
    }

    let totalSeconds=Math.floor(diff/1000);

    let hours=Math.floor(totalSeconds/3600);
    let minutes=Math.floor((totalSeconds%3600)/60);
    let seconds=totalSeconds%60;

    document.getElementById("countdown").innerHTML=
      `â³ Pulang dalam ${hours} jam ${minutes} menit ${seconds} detik`;

  },1000);
}


// ===== FORMAT GOOGLE DATE =====
function formatGoogleDate(date){
  return date.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";
}


// ===== HITUNG =====
function calculate(){

  const start=getWIB();
  start.setHours(hourSelect.value,minuteSelect.value,0);

  let end=new Date(start.getTime()+7.5*60*60*1000);

  let breakStart=new Date(start);
  breakStart.setHours(12,0,0);

  if(start<breakStart && end>breakStart){
    end=new Date(end.getTime()+30*60*1000);
  }

  end=new Date(end.getTime()+extraBreakSelect.value*60*1000);

  targetEndTime=end;
  startCountdown();

  let endH=String(end.getHours()).padStart(2,'0');
  let endM=String(end.getMinutes()).padStart(2,'0');

  document.getElementById("result").innerHTML=
    `âœ… Jam pulang kantor ${endH}:${endM}`;

  let url=
  `https://calendar.google.com/calendar/render?action=TEMPLATE`+
  `&text=Jam Pulang TownlandJKT (puasa version)`+
  `&dates=${formatGoogleDate(start)}/${formatGoogleDate(end)}`+
  `&ctz=Asia/Jakarta`;

  const btn=document.getElementById("calendarBtn");
  btn.style.display="block";
  btn.onclick=()=>window.open(url,"_blank");
}

</script>

</body>
</html>
